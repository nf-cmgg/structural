Changes in module 'nf-core/bcftools/reheader'
--- modules/nf-core/bcftools/reheader/main.nf
+++ modules/nf-core/bcftools/reheader/main.nf
@@ -12,8 +12,8 @@
     tuple val(meta2), path(fai)
 
     output:
-    tuple val(meta), path("*.{vcf,vcf.gz,bcf,bcf.gz}"), emit: vcf
-    path "versions.yml"                               , emit: versions
+    tuple val(meta), path("*.${extension}"), emit: vcf
+    path "versions.yml"                    , emit: versions
 
     when:
     task.ext.when == null || task.ext.when
@@ -22,20 +22,26 @@
     def args = task.ext.args ?: ''
     def prefix = task.ext.prefix ?: "${meta.id}"
     def fai_argument      = fai ? "--fai $fai" : ""
-    def header_argument   = header ? "--header $header" : ""
+    def header_argument   = header ? "--header new_header.vcf" : ""
     def samples_argument  = samples ? "--samples $samples" : ""
 
     def args2 = task.ext.args2 ?: '--output-type z'
-    def extension = args2.contains("--output-type b") || args2.contains("-Ob") ? "bcf.gz" :
+    extension = args2.contains("--output-type b") || args2.contains("-Ob") ? "bcf.gz" :
                     args2.contains("--output-type u") || args2.contains("-Ou") ? "bcf" :
                     args2.contains("--output-type z") || args2.contains("-Oz") ? "vcf.gz" :
                     args2.contains("--output-type v") || args2.contains("-Ov") ? "vcf" :
                     "vcf"
     """
+    # Get the header, append the missing fields and filter out duplicate lines
+    bcftools view --threads ${task.cpus} -h ${vcf} > ${prefix}.temp.header.vcf
+    sed -i '/##fileformat=/r ${header}' ${prefix}.temp.header.vcf
+    awk -F \\n '!seen[\$1]++' ${prefix}.temp.header.vcf > ${prefix}.header.vcf
+    rm ${prefix}.temp.header.vcf
+
     bcftools \\
         reheader \\
         $fai_argument \\
-        $header_argument \\
+        --header ${prefix}.header.vcf \\
         $samples_argument \\
         $args \\
         --threads $task.cpus \\
@@ -43,6 +49,8 @@
         | bcftools view \\
         $args2 \\
         --output ${prefix}.${extension}
+
+    rm ${prefix}.header.vcf
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":
@@ -54,7 +62,7 @@
     def args2 = task.ext.args2 ?: '--output-type z'
     def prefix = task.ext.prefix ?: "${meta.id}"
 
-    def extension = args2.contains("--output-type b") || args2.contains("-Ob") ? "bcf.gz" :
+    extension = args2.contains("--output-type b") || args2.contains("-Ob") ? "bcf.gz" :
                     args2.contains("--output-type u") || args2.contains("-Ou") ? "bcf" :
                     args2.contains("--output-type z") || args2.contains("-Oz") ? "vcf.gz" :
                     args2.contains("--output-type v") || args2.contains("-Ov") ? "vcf" :

************************************************************
